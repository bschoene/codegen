<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>TMS: Generator Anmeldeformular</title>

<link rel="stylesheet" href="css/bootstrap.min.css" media="all">
<link rel="stylesheet" href="css/bootstrap-theme.min.css">

<script src="lib/jquery-2.0.3.min.js"></script>
<script src="lib/bootstrap.min.js"></script>
<script src="lib/modal.js"></script>

</head>

<body>
<div class="wrap">
	<header id="js-header-main" class="header-main">
		<div class="container">
			<h1>Ticketmanagementsystem: Anmeldeformular erstellen</h1>
		</div>
	</header>
	
	<div class="container">
		<div id="sections"><!-- Sektionen werden hier eingefügt: Klick 'Neue Sektion erstellen' --></div>
		<hr>
		<div class="row">
			<div class="col-md-3"><button id="newsection" class="form-control btn btn-success">Neue Sektion erstellen</button></div>
			<div class="col-md-3"><button id="generate" class="form-control btn btn-danger">XML-Model generieren</button></div>
		</div>
	</div>
</div>


<!-- Patterns Start -->
<div id="patterns" style="display: none;">

	<!-- sectionpattern: Muster für eine Sektion -->
	<div id="sectionpattern" style="margin-bottom: 50px;">
		<legend><span>Sektion 1:</span> <input type="text" class="form-control"></legend>
		<div class="row lead">
			<div class="col-md-3">Bezeichnung</div>
			<div class="col-md-2">Type</div>
			<div class="col-md-1">Pflichtfeld</div>
			<div class="col-md-4">Optionen</div>
		</div>
		<div id="fields"><!-- Felder werden hier eingefügt: Klick 'Formularfeld anlegen' --></div>
		<!-- newfield: Formular zum eingeben von Informationen zum Formularfeld -->
		<form id="newfield">
			<div class="row" style="margin-top: 20px;">
				<div class="col-md-3"><input id="label" type="text" class="form-control"></div>
				<div class="col-md-2"><select id="type" class="form-control">
										<option></option>
										<option>text</option>
										<option value="select">select</option>
									  </select></div>
				<div class="col-md-1"><input id="mandatory" type="checkbox" class="form-control"></div>
				<div class="col-md-4"><input id="options" type="text" class="form-control" style="display: none;"></div>
				<div class="col-md-2"><button id="addfield" class="form-control btn btn-info" type="button">Formularfeld anlegen</button></div>
			</div>
		</form>
	</div>

	<!-- fieldpattern: Muster für einen Datensatz zu einem Formularfeld -->
	<div id="fieldpattern" class="row">
		<div id="label" class="col-md-3"></div>
		<div id="type" class="col-md-1"></div>
		<div id="mandatory" class="col-md-1"></div>
		<div id="options" class="col-md-5"></div>
	</div>
</div>
<!-- Patterns End -->

<!-- Formular - Datensätze sammeln -->
<form id="collect" action="generate.php" method="get6">

</form>
<!-- End Formular -->


<!-- Lightbox start -->
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog" style="width: 936px;">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h1>XML-Model</h41>
      </div>
      <div class="modal-body">
        ...
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- Lightbox end -->

<script type="text/javascript">

var sectionno = 0;	//Zähler für Sektionen
var fieldno   = 0;	//Zähler für Feldnummern

//Klick auf 'XML-Model generieren'
$("button#generate").click(function() {
	$('#myModal').modal('show');
	$.ajax({
		  type: "GET",
		  url: "generate.php",
		  data:  $('#collect').serialize(),
		  success: function (result) {
			$('.modal-body').html(result);
	      }
		})
	//$("#collect").submit();
});

//Klick auf 'Neue Sektion erstellen'
$("button#newsection").click(function() {
	sectionno++;
	$("#section" + sectionbefore + " #newfield").remove();
	var sectionbefore = sectionno-1;
	$("#sectionpattern").clone().appendTo("#sections");
	$("#sections #sectionpattern").attr("id","section"+sectionno);
	$("#section" + sectionno + " legend").text("Sektion " + sectionno);
	$("#section" + sectionno + " #addfield").click(function(){
		addnewfield();
	});
	$("select#type").change(function(){
		if($("select#type").val() == 'select'){
			$("input#options").css("display","block");
		}
	})
});

//Resets given form
function resetForm(element) {
	$(element).each(function(){
		this.reset();
	});
}

//Fieldtype: 'select' selected > show options input


//Click button 'Formularfeld anlegen'
//	- clones div model 'fieldnew'
//	- change id to 'field[n]'
//	- hides options input
//	- 
//	- delete
function addnewfield() {
	fieldno++;
	$("#fieldpattern").clone().appendTo("#section" + sectionno +" #fields");
	$("#fields #fieldpattern").attr("id","field" + fieldno);
	copyItemsToDiv();
	resetForm("form#newfield");
	$("input#options").css("display","none");
	$("input#label").focus();
}

//Kopiert die eingegebenen Informationen in das neu angelegte Feld einer Sektion
function copyItemsToDiv() {
	var label = $("input#label").val();
	var type  = $("select#type").val();
	var mandatory = $("input#mandatory:checked").val();
	var options = $("input#options").val();
	if(mandatory == "on") {
		mandatory = "1";
	} else {
		mandatory = "0";
	}
	$("#section" + sectionno +" #field" + fieldno + " #label").text(label);
	$("#section" + sectionno +" #field" + fieldno + " #type").text(type);
	$("#section" + sectionno +" #field" + fieldno + " #mandatory").text(mandatory);
	$("#section" + sectionno +" #field" + fieldno + " #options").text(options);
	$("#collect").append('<input type="hidden" name="'+sectionno+'label'+fieldno+'" value="'+label+'">').append();
	$("#collect").append('<input type="hidden" name="'+sectionno+'type'+fieldno+'" value="'+type+'">');
	$("#collect").append('<input type="hidden" name="'+sectionno+'mandatory'+fieldno+'" value="'+mandatory+'">');
	$("#collect").append('<input type="hidden" name="'+sectionno+'options'+fieldno+'" value="'+options+'">');
}
</script>
</body>
</html>